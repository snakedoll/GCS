# AI 컨텍스트 문서

이 문서는 프로젝트의 최근 작업 내용, 구현 결정 사항, 그리고 향후 작업 계획을 기록합니다.

## 📋 최근 작업 내용 (2024년 12월)

### 1. 로그아웃 기능 및 헤더 개선
- **파일**: `components/Header.tsx`
- **변경 사항**:
  - 로그인 상태일 때 헤더 우측에 로그아웃 아이콘 추가
  - 로그아웃 아이콘 클릭 시 `localStorage` 토큰 제거 및 홈으로 리다이렉트
  - 헤더 레이아웃을 `flex`에서 `grid grid-cols-3`로 변경하여 로고 중앙 정렬
  - 햄버거 메뉴(좌측), 로고(중앙), 로그인/마이페이지 아이콘(우측) 배치

### 2. 상품 관리 페이지 구현
- **파일**: `app/myPage/products/page.tsx` (신규)
- **기능**:
  - 사용자가 등록한 상품 목록 표시
  - `/api/user/products` API를 통한 상품 데이터 조회
  - 상품 카드 UI (이미지, 제목, 상태, 좋아요/리뷰 수 등)
  - 상품이 없을 때 빈 상태 메시지 표시
  - 플로팅 액션 버튼(`+`)으로 상품 등록 페이지 이동
  - '창작자 가이드 보러가기' 버튼 (외부 링크)

### 3. 상품 등록 1단계 페이지 구현
- **파일**: `app/myPage/products/register/page.tsx` (신규)
- **기능**:
  - 판매팀 입력 필드 (텍스트 입력 가능)
  - 판매방식 드롭다운 (Fund / Partner up)
  - 수령방식 선택 (택배 배송 / 현장 수령, 복수 선택 가능)
  - 상품명, 목표금액, 펀딩기간 입력
  - 상품 한줄설명 (15자 제한)
  - 제작/배송 일정 (텍스트 영역)
  - 정산계좌 (예금주명, 은행명, 계좌번호 분리 입력)
  - 대표 이미지 업로드 및 프리뷰
  - 본문 내용 이미지 업로드 및 프리뷰
  - `sessionStorage`에 1단계 데이터 저장 후 2단계로 이동

### 4. 상품 등록 2단계 페이지 구현
- **파일**: `app/myPage/products/register/options/page.tsx` (신규)
- **기능**:
  - 옵션 있음/없음 토글
  - 옵션 그룹 추가/삭제 (예: 색깔, 사이즈)
  - 옵션값 추가/삭제 (예: Red, Blue)
  - 옵션 조합 자동 생성 (카르테시안 곱)
  - 각 조합별 가격 입력
  - `sessionStorage`에서 1단계 데이터 조회
  - 1단계 + 2단계 데이터를 결합하여 `/api/products/requests`로 전송
  - 등록 완료 후 `/myPage/products`로 리다이렉트

### 5. 레이아웃 조건부 렌더링 개선
- **파일**: `components/ConditionalLayout.tsx`
- **변경 사항**:
  - `/myPage/products` 및 하위 경로에서 헤더와 푸터 숨김 처리
  - `isMyProductsPage` 조건 추가
  - 페이지별 독립적인 네비게이션 및 레이아웃 관리

### 6. 판매방식에 따른 필드 조건부 렌더링
- **파일**: `app/myPage/products/register/page.tsx`
- **변경 사항**:
  - 판매방식이 'Fund'일 때만 펀딩기간 필드 표시
  - 판매방식이 'Partner up'일 때는 펀딩기간 필드 숨김 및 검증 제외

### 7. 마이페이지 링크 추가
- **파일**: `app/myPage/page.tsx`
- **변경 사항**:
  - '내가 등록한 상품' 버튼 클릭 시 `/myPage/products`로 이동
  - '창작자 가이드' 버튼 클릭 시 `https://gcsweb.super.site/` 새 탭에서 열기

## 🔧 구현 결정 사항

### 1. 다단계 폼 데이터 관리
- **방식**: `sessionStorage` 사용
- **이유**: 
  - 페이지 이동 시 데이터 유지 필요
  - 새로고침 시에도 데이터 보존 (세션 종료 전까지)
  - 서버 부하 감소 (임시 데이터를 클라이언트에 저장)
- **저장 키**: `productRegistrationStep1`
- **데이터 구조**: JSON 문자열로 직렬화하여 저장

### 2. 이미지 처리
- **현재 구현**: 
  - FileReader API를 사용하여 Base64 인코딩
  - 프리뷰를 위한 Base64 데이터를 `sessionStorage`에 저장
  - 실제 파일은 `File` 객체로 별도 저장
- **한계점**:
  - Base64 데이터가 `sessionStorage` 크기 제한에 걸릴 수 있음
  - 실제 서버 업로드는 아직 미구현
- **향후 개선 필요**: 실제 이미지 파일을 서버에 업로드하는 API 구현

### 3. 헤더/푸터 관리
- **방식**: `ConditionalLayout` 컴포넌트에서 경로 기반 조건부 렌더링
- **제외 경로**:
  - `/myPage/products` 및 하위 경로: 헤더와 푸터 모두 숨김
  - `/archive/project/[id]`: 푸터만 숨김
  - 로그인/관리자 페이지: 헤더와 푸터 모두 숨김
- **이유**: 페이지별 독립적인 네비게이션 UI 필요

### 4. 판매방식별 필드 처리
- **Fund**: 목표금액, 펀딩기간 필수
- **Partner up**: 목표금액, 펀딩기간 필수 아님
- **구현**: `salesType` 상태값에 따라 필드 조건부 렌더링 및 검증 로직 분기

### 5. API 엔드포인트
- **GET `/api/user/products`**: 사용자가 등록한 상품 목록 조회
  - 사용자가 소속된 팀의 상품 목록 반환
  - 팀 정보, 이미지, 좋아요/리뷰 수 포함
- **POST `/api/products/requests`**: 상품 등록 요청 생성
  - `requestData` 객체를 받아 Product와 ProductRequest 생성
  - 현재는 JSON만 처리 (이미지 업로드는 별도 처리 필요)

## 🚧 다음에 해야 할 일

### 1. 이미지 업로드 기능 구현 (높은 우선순위)
- **문제점**: 현재 이미지는 Base64로 `sessionStorage`에만 저장되며, 실제 서버 업로드 미구현
- **필요 작업**:
  - 이미지 업로드 전용 API 엔드포인트 구현 (예: `/api/products/images`)
  - FormData를 사용한 멀티파트 파일 업로드 처리
  - 업로드된 이미지 URL을 상품 등록 데이터에 포함
  - `public/uploads/products/` 디렉토리에 파일 저장
  - 상품 등록 1단계 또는 2단계에서 이미지 업로드 수행

### 2. 상품 등록 완료 후 처리 개선
- **현재**: 2단계에서 `sessionStorage` 클리어 후 리다이렉트
- **개선 필요**:
  - 등록 성공 시 사용자에게 피드백 제공 (토스트 메시지 등)
  - 에러 처리 개선 (네트워크 오류, 서버 오류 등)
  - 등록 실패 시 `sessionStorage` 데이터 유지하여 재시도 가능하도록

### 3. 상품 등록 데이터 검증 강화
- **현재**: 클라이언트 측 기본 검증만 수행
- **개선 필요**:
  - 서버 측 검증 추가
  - 이미지 파일 타입 및 크기 제한 검증
  - 필수 필드 누락 체크
  - 데이터 형식 검증 (이메일, 전화번호 등)

### 4. 상품 목록 페이지 개선
- **필요 작업**:
  - 로딩 상태 UI 개선
  - 상품 상세 페이지로 이동 기능
  - 상품 수정/삭제 기능
  - 페이지네이션 (상품이 많을 경우)

### 5. 옵션 조합 자동 생성 로직 검증
- **현재**: 카르테시안 곱으로 옵션 조합 생성
- **검증 필요**:
  - 옵션이 많을 때 조합 수 폭발적 증가 문제
  - UI 성능 테스트
  - 조합 수 제한 또는 최적화 필요 여부 판단

### 6. 팀 정보 관리
- **현재**: 판매팀 필드가 텍스트 입력으로만 처리됨
- **개선 필요**:
  - 사용자가 소속된 팀 목록을 드롭다운으로 표시
  - 팀 API 엔드포인트 구현 또는 기존 API 활용
  - 팀 선택 시 자동으로 팀 정보 채우기

### 7. 상품 등록 요청 상태 관리
- **현재**: 상품 등록 후 `pending` 상태로 생성
- **개선 필요**:
  - 관리자 승인 프로세스 구현
  - 상품 등록 요청 상태 조회 페이지
  - 승인/거부 알림 기능

## 📝 참고 사항

### 현재 데이터베이스 스키마
- `Product`: 상품 기본 정보
- `ProductOption`: 상품 옵션 그룹
- `ProductOptionValue`: 옵션값
- `ProductImage`: 상품 이미지
- `ProductRequest`: 상품 등록 요청 (승인 대기 상태)
- `Team`: 판매팀 정보
- `TeamMember`: 사용자-팀 관계

### 기술 스택
- **프론트엔드**: Next.js 14 (App Router), React 18, TypeScript
- **스타일링**: Tailwind CSS
- **백엔드**: Next.js API Routes
- **데이터베이스**: PostgreSQL (Prisma ORM)
- **인증**: JWT (Bearer Token)

### 주요 의존성
- `@prisma/client`: 데이터베이스 ORM
- `jsonwebtoken`: JWT 토큰 처리
- `bcryptjs`: 비밀번호 해싱
- `next/image`: 이미지 최적화

## 🔄 마지막 업데이트
- **날짜**: 2024년 12월
- **커밋**: `feat: implement product registration pages and logout functionality`
- **주요 변경**: 상품 등록 페이지 구현, 로그아웃 기능 추가, 판매방식별 필드 조건부 렌더링
